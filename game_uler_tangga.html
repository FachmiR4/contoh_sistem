<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ular Tangga Multiplayer</title>
  <style>
    :root{
      --accent:#1e40af;
      --btn-grad: linear-gradient(90deg,#4f8cff 0%,#1e40af 100%);
    }
    *{box-sizing:border-box}
    body {
      text-align: center;
      font-family: 'Segoe UI', Arial, sans-serif;
      background: linear-gradient(120deg, #e0e7ff 0%, #f4f4f4 100%);
      margin: 0;
      min-height: 100vh;
      padding-bottom: 40px;
    }
    h1 {
      color: var(--accent);
      margin-top: 20px;
      margin-bottom: 8px;
      letter-spacing: 1px;
      font-size: clamp(1.25rem, 2.2vw, 2.2rem);
    }

    #controls {
      margin: 16px auto;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 2px 12px rgba(30,64,175,0.08);
      padding: 14px;
      max-width: 500px;
      width: calc(100% - 32px);
    }
    label{ font-weight:600; color:#0f172a; display:block; margin-bottom:6px; }
    #playerCount { width:72px; padding:6px; border-radius:8px; border:1px solid #e2e8f0; font-size:1rem; }
    .name-input { margin:6px 0; padding:8px 10px; border-radius:8px; border:1px solid #e2e8f0; width:100%; max-width:360px; }
    .controls-row { display:flex; gap:8px; align-items:center; justify-content:center; flex-wrap:wrap; margin-bottom:8px; }

    button {
      padding:10px 16px; margin:6px 4px; font-size:15px; border-radius:8px; border: none;
      background: var(--btn-grad); color:#fff; font-weight:700; cursor:pointer;
      box-shadow: 0 4px 14px rgba(30,64,175,0.12);
    }
    button:disabled { opacity:0.6; cursor:not-allowed; transform:none; box-shadow:none; }

    #turnInfo { font-size:1rem; color:var(--accent); margin-top:8px; font-weight:600; }
    #diceResult{ font-size:0.95rem; margin:4px 0 0; color:#064e3b; font-weight:700; }
    #diceImage img{ width:54px; height:54px; display:block; margin:8px auto 0; }

    /* Board: responsive square that uses background image */
    #board {
      background-image: url('depositphotos_655853034-stock-illustration-ladder-snakes-game-funny-frame.jpg');
      background-size: cover;
      background-position: center;
      width: min(720px, 96vw);
      height: min(770px, 96vw);
      margin: 20px auto;
      position: relative;
      border-radius: 12px;
      box-shadow: 0 6px 28px rgba(2,6,23,0.12);
      border: 3px solid rgba(14,50,105,0.08);
      overflow: hidden;
    }

    /* player tokens: sized relative to board */
    .player {
      width: clamp(20px, 6vw, 36px);
      height: clamp(20px, 6vw, 36px);
      border-radius: 50%;
      position: absolute;
      transform: translate(-50%, -50%); /* center on cell */
      text-align: center;
      line-height: clamp(20px, 6vw, 36px);
      color: white;
      font-size: clamp(10px, 3.2vw, 14px);
      font-weight: 800;
      border: 2px solid #fff;
      box-shadow: 0 4px 10px rgba(2,6,23,0.18);
      z-index: 5;
      transition: left 300ms cubic-bezier(.2,.9,.2,1), top 300ms cubic-bezier(.2,.9,.2,1);
      display:flex; align-items:center; justify-content:center;
    }

    #log {
      max-height: 200px;
      overflow-y: auto;
      background: #fff;
      padding: 10px;
      border: 1px solid #e6eef8;
      width: min(720px, 96vw);
      margin: 8px auto 0;
      text-align: left;
      border-radius: 8px;
      font-size: 0.95rem;
      box-shadow: 0 3px 12px rgba(30,64,175,0.06);
    }

    /* small responsive tweaks */
    @media (max-width: 520px) {
      #controls{ padding:12px }
      .controls-row{ flex-direction:column }
      button{ width:100%; max-width:360px }
    }
  </style>
</head>
<body>
  <h1>Game Ular Tangga ‚Äî Multiplayer</h1>

  <div id="controls" aria-label="controls">
    <div class="controls-row">
      <div>
        <label for="playerCount">Jumlah Pemain</label>
        <input type="number" id="playerCount" min="2" max="6" value="2" onchange="generateNameInputs()">
      </div>
      <div style="min-width:120px;">
        <label>&nbsp;</label>
        <div style="display:flex; gap:8px;">
          <button id="startBtn" onclick="startGame()">Mulai</button>
          <button id="rollBtn" onclick="rollDice()" disabled>Lempar Dadu</button>
        </div>
      </div>
    </div>

    <div id="playerNames" style="display:flex; flex-direction:column; align-items:center;"></div>

    <p id="turnInfo" aria-live="polite"></p>
    <div id="diceImage" aria-hidden="true"></div>
    <p id="diceResult" aria-live="polite"></p>
  </div>

  <div id="board" role="application" aria-label="Papan Ular Tangga"></div>
  <div id="log" aria-live="polite"></div>

  <script>
    // ...existing code...
    const players = [];
    const colors = ['#ef4444','#2563eb','#16a34a','#f97316','#7c3aed','#0f172a'];
    let currentPlayer = 0;
    let positions = [];
    let names = [];
    let gameStarted = false;

    // example snakes & ladders (adjust as needed)
    const snakes = { 83: 61, 65: 46, 92: 72, 50: 31, 38: 22 };
    const ladders = { 5: 44, 58: 77, 60: 79, 28: 48, 36: 57, 86: 93, 22: 39 };

    window.addEventListener('load', generateNameInputs);
    window.addEventListener('resize', () => { if (gameStarted) updatePositions(); });

    function getPositionCoords(pos) {
      // compute based on actual board size so responsive across devices
      const board = document.getElementById('board');
      const rect = board.getBoundingClientRect();
      const cellW = rect.width / 10;
      const cellH = rect.height / 10;

      const row = Math.floor((pos - 1) / 10);
      const col = (row % 2 === 0) ? (pos - 1) % 10 : 9 - (pos - 1) % 10;

      // coordinates relative to board (center of cell)
      const x = col * cellW + cellW / 2;
      // row 0 is bottom row in game logic, so invert
      const y = (9 - row) * cellH + cellH / 2;
      return { x, y, cellW, cellH };
    }

    function generateNameInputs() {
      const count = parseInt(document.getElementById('playerCount').value) || 2;
      const container = document.getElementById('playerNames');
      container.innerHTML = '';
      for (let i = 0; i < count; i++) {
        const input = document.createElement('input');
        input.type = 'text';
        input.placeholder = `Nama Pemain ${i + 1}`;
        input.className = 'name-input';
        input.maxLength = 12;
        container.appendChild(input);
      }
    }

    function startGame() {
      const count = parseInt(document.getElementById('playerCount').value) || 2;
      const nameInputs = document.querySelectorAll('#playerNames input');
      const board = document.getElementById('board');
      const log = document.getElementById('log');
      board.innerHTML = '';
      log.innerHTML = '';
      players.length = 0;
      names = [];
      positions = new Array(count).fill(1); // start at square 1

      nameInputs.forEach((input, i) => { names.push((input.value.trim()) || `P${i+1}`); });

      // create player tokens
      for (let i = 0; i < count; i++) {
        const div = document.createElement('div');
        div.className = 'player';
        div.style.background = colors[i % colors.length];
        div.textContent = names[i][0]?.toUpperCase() || (i+1);
        div.title = names[i];
        // ensure tokens are positioned relative to board
        board.appendChild(div);
        players.push(div);
      }

      // initial placement and UI
      updatePositions();
      currentPlayer = 0;
      document.getElementById('turnInfo').textContent = `Giliran: ${names[currentPlayer]}`;
      document.getElementById('rollBtn').disabled = false;
      gameStarted = true;
      loadLog();
      document.getElementById('diceResult').textContent = '';
      document.getElementById('diceImage').innerHTML = '';
    }

    function rollDice() {
      if (!gameStarted || players.length === 0) return;
      document.getElementById('diceResult').textContent = 'Mengocok...';
      document.getElementById('diceImage').innerHTML = '<img src="https://upload.wikimedia.org/wikipedia/commons/2/2c/Alea_1.png" width="54" alt="dice">';
      document.getElementById('rollBtn').disabled = true;

      setTimeout(() => {
        const dice = Math.floor(Math.random() * 6) + 1;
        let pos = positions[currentPlayer] + dice;
        if (pos > 100) pos = 100 - (pos - 100);

        let logText = `${names[currentPlayer]} melempar dadu: ${dice}, ke posisi ${pos}`;

        if (snakes[pos]) {
          logText += `, kena üêç turun ke ${snakes[pos]}`;
          pos = snakes[pos];
        } else if (ladders[pos]) {
          logText += `, naik ü™ú ke ${ladders[pos]}`;
          pos = ladders[pos];
        }

        positions[currentPlayer] = pos;
        updatePositions();
        document.getElementById('diceResult').textContent = `${names[currentPlayer]} dapat ${dice}`;
        document.getElementById('diceImage').innerHTML = `<img src="https://upload.wikimedia.org/wikipedia/commons/${getDiceImage(dice)}" width="54" alt="dice">`;
        logAction(logText);

        if (pos === 100) {
          setTimeout(() => {
            alert(`${names[currentPlayer]} menang!`);
            document.getElementById('turnInfo').textContent = `${names[currentPlayer]} MENANG!`;
            document.getElementById('rollBtn').disabled = true;
            gameStarted = false;
          }, 300);
          return;
        }

        if (dice !== 6) currentPlayer = (currentPlayer + 1) % players.length;
        else logAction(`${names[currentPlayer]} dapat 6 dan mendapat giliran lagi!`);

        document.getElementById('turnInfo').textContent = `Giliran: ${names[currentPlayer]}`;
        document.getElementById('rollBtn').disabled = false;
      }, 600);
    }

    function getDiceImage(val) {
      const map = {
        1: '2/2c/Alea_1.png',
        2: 'b/b8/Alea_2.png',
        3: '2/2f/Alea_3.png',
        4: '8/8d/Alea_4.png',
        5: '5/55/Alea_5.png',
        6: 'f/f4/Alea_6.png'
      };
      return map[val];
    }

    function updatePositions() {
      // position each player token to center of its square
      for (let i = 0; i < players.length; i++) {
        const { x, y, cellW, cellH } = getPositionCoords(positions[i]);
        // Slight offset to separate overlapping tokens inside same cell
        const offset = Math.min(cellW, cellH) * 0.18;
        const angle = (i / players.length) * Math.PI * 2;
        const dx = Math.round(Math.cos(angle) * offset);
        const dy = Math.round(Math.sin(angle) * offset);
        players[i].style.left = `${x + dx}px`;
        players[i].style.top = `${y + dy}px`;
      }
    }

    function logAction(text) {
      const log = document.getElementById('log');
      const p = document.createElement('p');
      p.textContent = text;
      log.prepend(p);
      saveLog(text);
    }

    function saveLog(entry) {
      const existing = JSON.parse(localStorage.getItem('gameLog') || '[]');
      existing.unshift(entry);
      localStorage.setItem('gameLog', JSON.stringify(existing.slice(0, 50)));
    }

    function loadLog() {
      const log = document.getElementById('log');
      const existing = JSON.parse(localStorage.getItem('gameLog') || '[]');
      log.innerHTML = '';
      existing.forEach(entry => {
        const p = document.createElement('p');
        p.textContent = entry;
        log.appendChild(p);
      });
    }
  </script>
</body>
</html>